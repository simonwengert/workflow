
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>First Example &#8212; workflow  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Overview" href="overview.html" />
    <link rel="prev" title="Welcome to Workflow’s documentation!" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">workflow  documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   First Example
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="overview.html">
   Overview
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="overview.overall_design.html">
     Overall design
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="overview.configset.html">
     Input and output of atomic structures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="overview.parallelisation.html">
     Automatic parallelization of tasks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="overview.queued.html">
     Functions as independently queued jobs
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="operations.html">
   Operations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="operations.calculators.html">
     Calculators in Workflow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="operations.generate.html">
     Generating Atomic Structures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="operations.descriptors.html">
     Descriptors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="operations.select.html">
     Selecting Configs
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="operations.fitting.html">
     Fitting potentials
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="operations.gap_fitting.html">
       Fitting GAP
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="operations.multistage_gap_fitting.html">
       Multistage GAP fitting
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="operations.ace_fitting.html">
       Fitting ACE
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="examples.html">
   Examples
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="examples.index.html">
     Index
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="examples.dimers.html">
     Generating Dimer Structures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="examples.buildcell.html">
     Random Structures via buildcell
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="examples.orca_python.html">
     ORCA via Python script
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="examples.mace.html">
     Parallelize MACE calculator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="examples.mlip_fitting.html">
     Fitting a MLIP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="examples.normal_modes.html">
     Normal Modes of molecules
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="examples.smiles.html">
     SMILES to
     <code class="docutils literal notranslate">
      <span class="pre">
       Atoms
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="examples.md.html">
     Molecular Dynamics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="examples.contributions.html">
     Contributing Examples
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="workflows.rss.html">
   GAP-RSS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="command_line.automatic_docs.html">
   Command line interface
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="modules.html">
   Modules
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="wfl.html">
     wfl package
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="wfl.autoparallelize.html">
       wfl.autoparallelize package
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="wfl.calculators.html">
       wfl.calculators package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
      <label for="toctree-checkbox-7">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="wfl.calculators.orca.html">
         wfl.calculators.orca package
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="wfl.cli.html">
       wfl.cli package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
      <label for="toctree-checkbox-8">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="wfl.cli.commands.html">
         wfl.cli.commands package
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="wfl.descriptors.html">
       wfl.descriptors package
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="wfl.fit.html">
       wfl.fit package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
      <label for="toctree-checkbox-9">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="wfl.fit.gap.html">
         wfl.fit.gap package
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="wfl.fit.modify_database.html">
         wfl.fit.modify_database package
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="wfl.generate.html">
       wfl.generate package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
      <label for="toctree-checkbox-10">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="wfl.generate.md_PROTECT.html">
         wfl.generate.md package
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="wfl.scripts.html">
       wfl.scripts package
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="wfl.select.html">
       wfl.select package
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="wfl.utils.html">
       wfl.utils package
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/first_example.md.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   First Example
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#complete-script">
     Complete script
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#with-remote-execution">
   With remote execution
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Complete script
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>First Example</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   First Example
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#complete-script">
     Complete script
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#with-remote-execution">
   With remote execution
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Complete script
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="section" id="first-example">
<span id="id1"></span><h1>First Example<a class="headerlink" href="#first-example" title="Permalink to this headline">#</a></h1>
<p>One of the main uses of Workflow is to parallelise per-<code class="docutils literal notranslate"><span class="pre">Atoms</span></code> operations over multiple cores.</p>
<p>For example, let’s say we have created a number of atomic structures (“configurations” or “configs”):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ase.build</span> <span class="kn">import</span> <span class="n">bulk</span>
<span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">320</span><span class="p">):</span>
    <span class="n">at</span> <span class="o">=</span> <span class="n">bulk</span><span class="p">(</span><span class="s2">&quot;Cu&quot;</span><span class="p">,</span> <span class="s2">&quot;fcc&quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">3.6</span><span class="p">,</span> <span class="n">cubic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">at</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">at</span><span class="o">.</span><span class="n">rattle</span><span class="p">(</span><span class="n">stdev</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">159</span><span class="o">+</span><span class="n">idx</span><span class="p">)</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>
</pre></div>
</div>
<p>One of the most common type of operations is to evaluate energies, forces and stresses of these structures, here with an <a class="reference external" href="https://wiki.fysik.dtu.dk/ase/ase/calculators/emt.html#module-ase.calculators.emt">EMT calculator</a> included in ASE. Normally, the these properties would be obtained and saved by looping through the structures:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ase.calculators.emt</span> <span class="kn">import</span> <span class="n">EMT</span>
<span class="n">calc</span> <span class="o">=</span> <span class="n">EMT</span><span class="p">()</span>

<span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
    <span class="n">at</span><span class="o">.</span><span class="n">calc</span> <span class="o">=</span> <span class="n">EMT</span><span class="p">()</span>
    <span class="n">at</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;emt_energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">at</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">()</span>
    <span class="n">at</span><span class="o">.</span><span class="n">arrays</span><span class="p">[</span><span class="s2">&quot;emt_forces&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">at</span><span class="o">.</span><span class="n">get_forces</span><span class="p">()</span>
    <span class="n">at</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;emt_stress&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">at</span><span class="o">.</span><span class="n">get_stress</span><span class="p">()</span>

<span class="n">write</span><span class="p">(</span><span class="s2">&quot;configs.emt.xyz&quot;</span><span class="p">,</span> <span class="n">atoms</span><span class="p">)</span>
</pre></div>
</div>
<p>Often property evaluation for each structure might take minutes or hours and there might be hundreds or thousands of configs in the dataset. In such cases the evaluation is performed as a job on a supercomputer and Workflow may be used to efficiently parallelise the property evaluation over all cores available to the job. For this, the script above is writen as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ase.calculators.emt</span> <span class="kn">import</span> <span class="n">EMT</span> 
<span class="kn">from</span> <span class="nn">wfl.calculators</span> <span class="kn">import</span> <span class="n">generic</span>
<span class="kn">from</span> <span class="nn">wfl.autoparallelize.autoparainfo</span> <span class="kn">import</span> <span class="n">AutoparaInfo</span>
<span class="kn">from</span> <span class="nn">wfl.configset</span> <span class="kn">import</span> <span class="n">ConfigSet</span><span class="p">,</span> <span class="n">OutputSpec</span>

<span class="n">configset</span> <span class="o">=</span> <span class="n">ConfigSet</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
<span class="n">outputspec</span> <span class="o">=</span> <span class="n">OutputSpec</span><span class="p">(</span><span class="s2">&quot;configs.emt.xyz&quot;</span><span class="p">)</span>
<span class="n">calculator</span> <span class="o">=</span> <span class="p">(</span><span class="n">EMT</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{})</span>

<span class="n">generic</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">configset</span><span class="p">,</span> 
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">outputspec</span><span class="p">,</span> 
    <span class="n">calculator</span> <span class="o">=</span> <span class="n">calculator</span><span class="p">,</span> 
    <span class="n">output_prefix</span> <span class="o">=</span> <span class="s2">&quot;emt_&quot;</span><span class="p">,</span> 
    <span class="n">autopara_info</span> <span class="o">=</span> <span class="n">AutoparaInfo</span><span class="p">(</span>
        <span class="n">num_python_subprocesses</span> <span class="o">=</span> <span class="mi">8</span>    
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">generic.run()</span></code> is the main function that is used to parallelise any* ASE calculator. It returns a ConfigSet object with configs containing the results.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ConfigSet</span></code> and <code class="docutils literal notranslate"><span class="pre">OutputSpec</span></code> are used to specify where to read the atomic configs from and write the processed configs to. There are a number of ways to specify read/write destination (e.g. <code class="docutils literal notranslate"><span class="pre">list(Atoms)</span></code> or file(s) as above) when creating <code class="docutils literal notranslate"><span class="pre">ConfigSet</span></code> and <code class="docutils literal notranslate"><span class="pre">OutputSpec</span></code>, but functions such as <code class="docutils literal notranslate"><span class="pre">generic.run()</span></code> can have a consistent behaviour irrespective of where the configs came from.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">calculator</span></code> is specified in a way that is pickleable and may be used in spawned processes of <code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> package that is used by Workflow. It should be given as a tuple of <code class="docutils literal notranslate"><span class="pre">(calculator_constructor_function,</span> <span class="pre">arguments,</span> <span class="pre">keyword_arguments)</span></code>. For example, if a quippy calculator is normally instantiated as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">quippy.potential</span> <span class="kn">import</span> <span class="n">Potential</span>
<span class="n">calculator</span> <span class="o">=</span> <span class="n">Potential</span><span class="p">(</span><span class="s2">&quot;TB DFTB&quot;</span><span class="p">,</span> <span class="n">param_filename</span><span class="o">=</span><span class="s2">&quot;path/to/params.xml</span>
</pre></div>
</div>
<p>then for <code class="docutils literal notranslate"><span class="pre">generic.run()</span></code> it should be constructed as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>from quippy.potential import Potential`
calculator = (Potential, [&quot;TB DFTB&quot;], {&quot;param_filename&quot;:&quot;path/to/params.xml&quot;})
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_prefix</span></code> is prepended to each of the calculated properties, saved in <code class="docutils literal notranslate"><span class="pre">Atoms.info</span></code> or <code class="docutils literal notranslate"><span class="pre">Atoms.arrays</span></code> as appropriate.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">autopara_info</span></code> is used to control the parallelisation. <code class="docutils literal notranslate"><span class="pre">num_python_subprocesses</span></code> specifies how many parallel processes to spawn; a common option is to set as many as cores available for the job. More conveniently, <code class="docutils literal notranslate"><span class="pre">num_python_subprocesses</span></code> is set via a <code class="docutils literal notranslate"><span class="pre">WFL_NUM_PYTHON_SUBPROCESSES</span></code> environment variable.</p></li>
</ul>
<div class="section" id="complete-script">
<h2>Complete script<a class="headerlink" href="#complete-script" title="Permalink to this headline">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">evaluate_emt.py</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="kn">from</span> <span class="nn">ase.build</span> <span class="kn">import</span> <span class="n">bulk</span>
<span class="kn">from</span> <span class="nn">ase.calculators.emt</span> <span class="kn">import</span> <span class="n">EMT</span> 
<span class="kn">from</span> <span class="nn">wfl.calculators</span> <span class="kn">import</span> <span class="n">generic</span>
<span class="kn">from</span> <span class="nn">wfl.autoparallelize.autoparainfo</span> <span class="kn">import</span> <span class="n">AutoparaInfo</span>
<span class="kn">from</span> <span class="nn">wfl.configset</span> <span class="kn">import</span> <span class="n">ConfigSet</span><span class="p">,</span> <span class="n">OutputSpec</span>
<span class="kn">from</span> <span class="nn">wfl.autoparallelize.remote</span> <span class="n">info</span> <span class="kn">import</span> <span class="nn">RemoteInfo</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">expyre.resources</span> <span class="kn">import</span> <span class="n">Resources</span>

<span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
    <span class="n">at</span> <span class="o">=</span> <span class="n">bulk</span><span class="p">(</span><span class="s2">&quot;Cu&quot;</span><span class="p">,</span> <span class="s2">&quot;fcc&quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">3.6</span><span class="p">,</span> <span class="n">cubic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">at</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">at</span><span class="o">.</span><span class="n">rattle</span><span class="p">(</span><span class="n">stdev</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">159</span><span class="o">+</span><span class="n">idx</span><span class="p">)</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>

<span class="n">configset</span> <span class="o">=</span> <span class="n">ConfigSet</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
<span class="n">outputspec</span> <span class="o">=</span> <span class="n">OutputSpec</span><span class="p">(</span><span class="s2">&quot;configs.emt.xyz&quot;</span><span class="p">)</span>
<span class="n">calculator</span> <span class="o">=</span> <span class="p">(</span><span class="n">EMT</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{})</span>

<span class="n">generic</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">configset</span><span class="p">,</span> 
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">outputspec</span><span class="p">,</span> 
    <span class="n">calculator</span> <span class="o">=</span> <span class="n">calculator</span><span class="p">,</span> 
    <span class="n">output_prefix</span> <span class="o">=</span> <span class="s2">&quot;emt_&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">sun_grid_engine_sub.sh</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
#$ -pe smp 16        # number of cores requested
#$ -l h_rt=48:00:00  # time requested in HH:MM:SS format
#$ -S /bin/bash      # shell to run the job in
#$ -N eval_emt       # job name 
#$ -j yes            # combine error and output logs
#$ -cwd              # execute job in directory from which it was submitted
#$ -q &#39;standard&#39;

export WFL_NUM_PYTHON_SUBPROCESSES=$NSLOTS
python evaluate_emt.py
</pre></div>
</div>
</div>
</div>
<div class="section" id="with-remote-execution">
<h1>With remote execution<a class="headerlink" href="#with-remote-execution" title="Permalink to this headline">#</a></h1>
<p>Workflow also allows to submit (remotely) queued jobs automatically, by interfacing with ExPyRe (<a class="reference external" href="https://libatoms.github.io/ExPyRe/">docummentation</a>, <a class="reference external" href="https://github.com/libAtoms/ExPyRe/tree/main/expyre">repository</a>). In this example, instead of calling the above python script in a queue submission script, the modified python script is called from the head node and the parallelisation mechanism behind <code class="docutils literal notranslate"><span class="pre">generic.run()</span></code> sets up and submits the job and returns the results like the script normally would. To enable remote submission, <code class="docutils literal notranslate"><span class="pre">RemoteInfo</span></code> must be added to <code class="docutils literal notranslate"><span class="pre">AutoparaInfo</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wfl.autoparallelize.remoteinfo</span> <span class="kn">import</span> <span class="n">RemoteInfo</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">expyre.resources</span> <span class="kn">import</span> <span class="n">Resources</span>

<span class="n">remote_info</span> <span class="o">=</span> <span class="n">RemoteInfo</span><span class="p">(</span>
    <span class="n">sys_name</span> <span class="o">=</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span>
    <span class="n">job_name</span> <span class="o">=</span> <span class="s2">&quot;eval_emt&quot;</span><span class="p">,</span>
    <span class="n">num_inputs_per_queued_job</span> <span class="o">=</span> <span class="mi">160</span><span class="p">,</span>
    <span class="n">resources</span> <span class="o">=</span> <span class="n">Resources</span><span class="p">(</span>
        <span class="n">max_time</span> <span class="o">=</span> <span class="s2">&quot;48h&quot;</span><span class="p">,</span>
        <span class="n">num_nodes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">partitions</span> <span class="o">=</span> <span class="s2">&quot;standard&quot;</span><span class="p">))</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sys_name</span></code> picks which cluster to submit the job to. In this example, the script is executed from head node and jobs are submitted to compute nodes on the same cluster. Another example could execute the script on a laptop and submit the job over ssh to one of a number of accessible clusters.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">job_name</span></code> sets a prefix to each of the submitted jobs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_inputs_per_queued_job</span></code> specifies how many atomic structures (in this example) to assign to each job. Since the total number is 320, setting this argument to 160 means that in total two jobs will be submitted to the queue.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resources</span></code> sets which partition(s) (queues) the job will be sent to and what computational resources will be required in the automatically generated submission script.</p></li>
</ul>
<p>The available clusters are listed in <code class="docutils literal notranslate"><span class="pre">config.json</span></code> file, by default at <code class="docutils literal notranslate"><span class="pre">~/.expyre/config.json</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;local&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
        <span class="s2">&quot;scheduler&quot;</span><span class="p">:</span> <span class="s2">&quot;sge&quot;</span><span class="p">,</span>
        <span class="s2">&quot;commands&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;conda activate myenv&quot;</span><span class="p">],</span>
        <span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;#$ -pe smp </span><span class="si">{num_cores}</span><span class="s2">&quot;</span><span class="p">],</span>
        <span class="s2">&quot;partitions&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;standard&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;num_cores&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;max_time&quot;</span><span class="p">:</span> <span class="s2">&quot;168h&quot;</span><span class="p">,</span> <span class="s2">&quot;max_mem&quot;</span><span class="p">:</span> <span class="s2">&quot;200GB&quot;</span><span class="p">}}</span>
             <span class="p">}</span>
<span class="p">}}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">host</span></code> is set to <code class="docutils literal notranslate"><span class="pre">null</span></code>, because this example script is run on the head node of the cluster to which jobs are submitted. I.e. no submission via ssh is needed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scheduller</span></code> - the example cluster uses Sun Grid Engine to manage the queued jobs</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">commands</span></code> gives list of commands to execute in the automatically created submission script before a copy of the autoparallelised operation is launched.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">header</span></code> - any extra header lines to add.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">partitions</span></code> - names and resources available for the partitions (queues) of the cluster.</p></li>
</ul>
<div class="section" id="id2">
<h2>Complete script<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">evaluate_emt_remotely.py</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="kn">from</span> <span class="nn">ase.build</span> <span class="kn">import</span> <span class="n">bulk</span>
<span class="kn">from</span> <span class="nn">ase.calculators.emt</span> <span class="kn">import</span> <span class="n">EMT</span> 
<span class="kn">from</span> <span class="nn">wfl.calculators</span> <span class="kn">import</span> <span class="n">generic</span>
<span class="kn">from</span> <span class="nn">wfl.autoparallelize.autoparainfo</span> <span class="kn">import</span> <span class="n">AutoparaInfo</span>
<span class="kn">from</span> <span class="nn">wfl.configset</span> <span class="kn">import</span> <span class="n">ConfigSet</span><span class="p">,</span> <span class="n">OutputSpec</span>
<span class="kn">from</span> <span class="nn">wfl.autoparallelize.remoteinfo</span> <span class="kn">import</span> <span class="n">RemoteInfo</span>
<span class="kn">from</span> <span class="nn">expyre.resources</span> <span class="kn">import</span> <span class="n">Resources</span>

<span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
    <span class="n">at</span> <span class="o">=</span> <span class="n">bulk</span><span class="p">(</span><span class="s2">&quot;Cu&quot;</span><span class="p">,</span> <span class="s2">&quot;fcc&quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">3.6</span><span class="p">,</span> <span class="n">cubic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">at</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">at</span><span class="o">.</span><span class="n">rattle</span><span class="p">(</span><span class="n">stdev</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">159</span><span class="o">+</span><span class="n">idx</span><span class="p">)</span>
    <span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>

<span class="n">configset</span> <span class="o">=</span> <span class="n">ConfigSet</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
<span class="n">outputspec</span> <span class="o">=</span> <span class="n">OutputSpec</span><span class="p">(</span><span class="s2">&quot;configs.emt.xyz&quot;</span><span class="p">)</span>
<span class="n">calculator</span> <span class="o">=</span> <span class="p">(</span><span class="n">EMT</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{})</span>

<span class="n">remote_info</span> <span class="o">=</span> <span class="n">RemoteInfo</span><span class="p">(</span>
    <span class="n">sys_name</span> <span class="o">=</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span>
    <span class="n">job_name</span> <span class="o">=</span> <span class="s2">&quot;eval_emt&quot;</span><span class="p">,</span>
    <span class="n">num_inputs_per_queued_job</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
    <span class="n">resources</span> <span class="o">=</span> <span class="n">Resources</span><span class="p">(</span>
        <span class="n">max_time</span> <span class="o">=</span> <span class="s2">&quot;48h&quot;</span><span class="p">,</span>
        <span class="n">num_nodes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">partitions</span> <span class="o">=</span> <span class="s2">&quot;standard&quot;</span><span class="p">))</span>

<span class="n">generic</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">configset</span><span class="p">,</span> 
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">outputspec</span><span class="p">,</span> 
    <span class="n">calculator</span> <span class="o">=</span> <span class="n">calculator</span><span class="p">,</span> 
    <span class="n">output_prefix</span> <span class="o">=</span> <span class="s2">&quot;emt_&quot;</span><span class="p">,</span> 
    <span class="n">autopara_info</span> <span class="o">=</span> <span class="n">AutoparaInfo</span><span class="p">(</span>
        <span class="n">remote_info</span> <span class="o">=</span> <span class="n">remote_info</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Welcome to Workflow’s documentation!</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="overview.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Overview</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By N. Bernstein, T. K. Stenczel, E. Gelzinyte<br/>
  
      &copy; Copyright .<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>